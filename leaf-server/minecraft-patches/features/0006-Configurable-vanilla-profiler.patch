From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Dreeam <61569423+Dreeam-qwq@users.noreply.github.com>
Date: Thu, 8 Jan 2026 04:31:53 -0500
Subject: [PATCH] Configurable vanilla profiler

License: MIT (https://opensource.org/licenses/MIT)
Gale - https://galemc.org

Co-authored-by: Martijn Muijsers <martijnmuijsers@live.nl>

This patch is based on the following patch:
"Remove Mojang Profiler"
By: BillyGalbreath <blake.galbreath@gmail.com>
As part of: Purpur (https://github.com/PurpurMC/Purpur)
Licensed under: MIT (https://opensource.org/licenses/MIT)

* Purpur copyright *

MIT License

Copyright (c) 2019-2022 PurpurMC

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

diff --git a/net/minecraft/server/MinecraftServer.java b/net/minecraft/server/MinecraftServer.java
index e73013ee9199ac4d9b3b4bb36262e8240652040b..f86508fd765a821343f162398d7a274bd1009ccb 100644
--- a/net/minecraft/server/MinecraftServer.java
+++ b/net/minecraft/server/MinecraftServer.java
@@ -1376,7 +1376,7 @@ public abstract class MinecraftServer extends ReentrantBlockableEventLoop<TickTa
 
                 // Paper - improve tick loop - done above
 
-                try (Profiler.Scope scope = Profiler.use(this.createProfiler())) {
+                try (Profiler.Scope scope = org.dreeam.leaf.util.LeafConstants.DISABLE_VANILLA_PROFILER ? null : Profiler.use(this.createProfiler())) { // Leaf - Configurable vanilla profiler
                     this.processPacketsAndTick(flag);
                     ProfilerFiller profilerFiller = Profiler.get();
                     profilerFiller.push("nextTickWait");
diff --git a/net/minecraft/server/ReloadableServerResources.java b/net/minecraft/server/ReloadableServerResources.java
index e13ddecde6a5599a4688707a1898db093d314d2b..d9cae732e2692eaa514ba9c9b8375b90253547a1 100644
--- a/net/minecraft/server/ReloadableServerResources.java
+++ b/net/minecraft/server/ReloadableServerResources.java
@@ -100,7 +100,7 @@ public class ReloadableServerResources {
                             backgroundExecutor,
                             gameExecutor,
                             DATA_RELOAD_INITIAL_TASK,
-                            LOGGER.isDebugEnabled()
+                            !org.dreeam.leaf.util.LeafConstants.DISABLE_VANILLA_PROFILER // Leaf - Configurable vanilla profiler
                         )
                         .done()
                         .thenApply(object -> reloadableServerResources);
diff --git a/net/minecraft/server/commands/DebugCommand.java b/net/minecraft/server/commands/DebugCommand.java
index 05fa05111a99e1d4b4f992c2349f43125e8b330f..89bac8d8f257b35ae494ff81d304819038d35942 100644
--- a/net/minecraft/server/commands/DebugCommand.java
+++ b/net/minecraft/server/commands/DebugCommand.java
@@ -68,6 +68,7 @@ public class DebugCommand {
     }
 
     private static int start(CommandSourceStack source) throws CommandSyntaxException {
+        if (org.dreeam.leaf.util.LeafConstants.DISABLE_VANILLA_PROFILER) return 0; // Leaf - Configurable vanilla profiler
         MinecraftServer server = source.getServer();
         if (server.isTimeProfilerRunning()) {
             throw ERROR_ALREADY_RUNNING.create();
@@ -79,6 +80,7 @@ public class DebugCommand {
     }
 
     private static int stop(CommandSourceStack source) throws CommandSyntaxException {
+        if (org.dreeam.leaf.util.LeafConstants.DISABLE_VANILLA_PROFILER) return 0; // Leaf - Configurable vanilla profiler
         MinecraftServer server = source.getServer();
         if (!server.isTimeProfilerRunning()) {
             throw ERROR_NOT_RUNNING.create();
diff --git a/net/minecraft/server/commands/PerfCommand.java b/net/minecraft/server/commands/PerfCommand.java
index cdb4b00d636ba20e72b00dbb8cc34406819ac1b5..7d37c33533b524511cf28e98888cec8496b6585f 100644
--- a/net/minecraft/server/commands/PerfCommand.java
+++ b/net/minecraft/server/commands/PerfCommand.java
@@ -42,6 +42,7 @@ public class PerfCommand {
     }
 
     private static int startProfilingDedicatedServer(CommandSourceStack source) throws CommandSyntaxException {
+        if (org.dreeam.leaf.util.LeafConstants.DISABLE_VANILLA_PROFILER) return 0; // Leaf - Configurable vanilla profiler
         MinecraftServer server = source.getServer();
         if (server.isRecordingMetrics()) {
             throw ERROR_ALREADY_RUNNING.create();
@@ -55,6 +56,7 @@ public class PerfCommand {
     }
 
     private static int stopProfilingDedicatedServer(CommandSourceStack source) throws CommandSyntaxException {
+        if (org.dreeam.leaf.util.LeafConstants.DISABLE_VANILLA_PROFILER) return 0; // Leaf - Configurable vanilla profiler
         MinecraftServer server = source.getServer();
         if (!server.isRecordingMetrics()) {
             throw ERROR_NOT_RUNNING.create();
diff --git a/net/minecraft/server/packs/resources/ReloadableResourceManager.java b/net/minecraft/server/packs/resources/ReloadableResourceManager.java
index 52f7ab63a0f3b59ef068fc4417f9a2370301e31f..bef5e298acce72e35295dcea2a912512ee00f9fd 100644
--- a/net/minecraft/server/packs/resources/ReloadableResourceManager.java
+++ b/net/minecraft/server/packs/resources/ReloadableResourceManager.java
@@ -43,7 +43,7 @@ public class ReloadableResourceManager implements ResourceManager, AutoCloseable
         LOGGER.info("Reloading ResourceManager: {}", LogUtils.defer(() -> resourcePacks.stream().map(PackResources::packId).collect(Collectors.joining(", "))));
         this.resources.close();
         this.resources = new MultiPackResourceManager(this.type, resourcePacks);
-        return SimpleReloadInstance.create(this.resources, this.listeners, backgroundExecutor, gameExecutor, waitingFor, LOGGER.isDebugEnabled());
+        return SimpleReloadInstance.create(this.resources, this.listeners, backgroundExecutor, gameExecutor, waitingFor, !org.dreeam.leaf.util.LeafConstants.DISABLE_VANILLA_PROFILER); // Leaf - Configurable vanilla profiler
     }
 
     @Override
diff --git a/net/minecraft/util/profiling/Profiler.java b/net/minecraft/util/profiling/Profiler.java
index 9567003a8ed1a3783b743553ce8f690756da868d..7bc414aeb7d07fba692c8c2256ffa26729dcbd94 100644
--- a/net/minecraft/util/profiling/Profiler.java
+++ b/net/minecraft/util/profiling/Profiler.java
@@ -45,6 +45,7 @@ public final class Profiler {
     }
 
     public static ProfilerFiller get() {
+        if (org.dreeam.leaf.util.LeafConstants.DISABLE_VANILLA_PROFILER) return InactiveProfiler.INSTANCE; // Leaf - Configurable vanilla profiler
         return ACTIVE_COUNT.get() == 0 ? getDefaultFiller() : Objects.requireNonNullElseGet(ACTIVE.get(), Profiler::getDefaultFiller);
     }
 
