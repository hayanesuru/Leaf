From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: HaHaWTH <102713261+HaHaWTH@users.noreply.github.com>
Date: Tue, 9 Nov 2077 00:00:00 +0800
Subject: [PATCH] Cache world border

The world border is only initialized once when the level is created.
Lookup from data storage map multiple time is quite unnecessary and expensive.

diff --git a/net/minecraft/server/level/ServerLevel.java b/net/minecraft/server/level/ServerLevel.java
index f6ae220437aff87fb1371fa9b17574183bef4dfa..d3f8b8adf063cf8f93a063df87eb9986a3f5d996 100644
--- a/net/minecraft/server/level/ServerLevel.java
+++ b/net/minecraft/server/level/ServerLevel.java
@@ -235,6 +235,7 @@ public class ServerLevel extends Level implements ServerEntityGetter, WorldGenLe
     private final alternate.current.wire.WireHandler wireHandler = new alternate.current.wire.WireHandler(this); // Paper - optimize redstone (Alternate Current)
     public boolean hasRidableMoveEvent = false; // Purpur - Ridables
     public final org.dreeam.leaf.async.tracker.AsyncTracker leaf$asyncTracker = new org.dreeam.leaf.async.tracker.AsyncTracker(this); // Leaf - Multithreaded tracker
+    private @Nullable WorldBorder worldBorder; // Leaf - Cache world border
 
     @Override
     public @Nullable LevelChunk getChunkIfLoaded(int x, int z) {
@@ -2394,8 +2395,14 @@ public class ServerLevel extends Level implements ServerEntityGetter, WorldGenLe
 
     @Override
     public WorldBorder getWorldBorder() {
+        // Leaf start - Cache world border
+        if (this.worldBorder != null) {
+            return this.worldBorder;
+        }
+        // Leaf end - Cache world border
         WorldBorder worldBorder = this.getDataStorage().computeIfAbsent(WorldBorder.TYPE);
         worldBorder.applyInitialSettings(this.levelData.getGameTime());
+        this.worldBorder = worldBorder; // Leaf - Cache world border
         return worldBorder;
     }
 
