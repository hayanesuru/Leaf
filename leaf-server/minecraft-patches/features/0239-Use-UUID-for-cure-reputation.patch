From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: HaHaWTH <102713261+HaHaWTH@users.noreply.github.com>
Date: Tue, 9 Nov 2077 00:00:00 +0800
Subject: [PATCH] Use UUID for cure reputation

Related MC issue: https://bugs.mojang.com/browse/MC/issues/MC-247647

diff --git a/net/minecraft/world/entity/monster/zombie/ZombieVillager.java b/net/minecraft/world/entity/monster/zombie/ZombieVillager.java
index 66e79d91ab1d3850ebfd34d7fc8e1d5b3510ce56..9249232f8d28ac86578cdf7bd877b54c90e5fd1e 100644
--- a/net/minecraft/world/entity/monster/zombie/ZombieVillager.java
+++ b/net/minecraft/world/entity/monster/zombie/ZombieVillager.java
@@ -322,9 +322,10 @@ public class ZombieVillager extends Zombie implements VillagerDataHolder {
                 mob.refreshBrain(level);
                 if (this.conversionStarter != null) {
                     Player playerByUuid = level.getGlobalPlayerByUUID(this.conversionStarter); // Paper - check global player list where appropriate
+                    mob.onReputationEventFromUUID(ReputationEventType.ZOMBIE_VILLAGER_CURED, this.conversionStarter); // Leaf - Use UUID for cure reputation
                     if (playerByUuid instanceof ServerPlayer) {
                         CriteriaTriggers.CURED_ZOMBIE_VILLAGER.trigger((ServerPlayer)playerByUuid, this, mob);
-                        level.onReputationEvent(ReputationEventType.ZOMBIE_VILLAGER_CURED, playerByUuid, mob);
+                        //level.onReputationEvent(ReputationEventType.ZOMBIE_VILLAGER_CURED, playerByUuid, mob); // Leaf - Use UUID for cure reputation - move up
                     }
                 }
 
diff --git a/net/minecraft/world/entity/npc/villager/Villager.java b/net/minecraft/world/entity/npc/villager/Villager.java
index fe122a1026c198abec959b7980db46262af5685d..5f49110c3ac02ff6e7d2f3b0f60f74e5d64f2ee2 100644
--- a/net/minecraft/world/entity/npc/villager/Villager.java
+++ b/net/minecraft/world/entity/npc/villager/Villager.java
@@ -1107,6 +1107,21 @@ public class Villager extends AbstractVillager implements ReputationEventHandler
         }
     }
 
+    // Leaf start - Use UUID for cure reputation
+    public void onReputationEventFromUUID(ReputationEventType type, java.util.UUID target) {
+        if (type == ReputationEventType.ZOMBIE_VILLAGER_CURED) {
+            this.gossips.add(target, GossipType.MAJOR_POSITIVE, 20);
+            this.gossips.add(target, GossipType.MINOR_POSITIVE, 25);
+        } else if (type == ReputationEventType.TRADE) {
+            this.gossips.add(target, GossipType.TRADING, 2);
+        } else if (type == ReputationEventType.VILLAGER_HURT) {
+            this.gossips.add(target, GossipType.MINOR_NEGATIVE, 25);
+        } else if (type == ReputationEventType.VILLAGER_KILLED) {
+            this.gossips.add(target, GossipType.MAJOR_NEGATIVE, 25);
+        }
+    }
+    // Leaf end - Use UUID for cure reputation
+
     @Override
     public int getVillagerXp() {
         return this.villagerXp;
