From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Dreeam <61569423+Dreeam-qwq@users.noreply.github.com>
Date: Thu, 12 Dec 2024 02:58:34 -0500
Subject: [PATCH] Cache ShapePairKey hash


diff --git a/net/minecraft/world/level/block/Block.java b/net/minecraft/world/level/block/Block.java
index ae3e6e31171b1bcfba1ae51a0941b52dda270acd..064e08e28acf7497e950d4e7f6ad7bddd92418b4 100644
--- a/net/minecraft/world/level/block/Block.java
+++ b/net/minecraft/world/level/block/Block.java
@@ -610,7 +610,20 @@ public class Block extends BlockBehaviour implements ItemLike {
     }
     // CraftBukkit end
 
-    record ShapePairKey(VoxelShape first, VoxelShape second) {
+    // Gale start - cache ShapePairKey hash
+    static class ShapePairKey {
+
+        private final VoxelShape first;
+        private final VoxelShape second;
+        private final int hash;
+
+        private ShapePairKey(VoxelShape first, VoxelShape second) {
+            this.first = first;
+            this.second = second;
+            this.hash = System.identityHashCode(this.first) * 31 + System.identityHashCode(this.second);
+        }
+        // Gale end - cache ShapePairKey hash
+
         @Override
         public boolean equals(Object other) {
             return other instanceof Block.ShapePairKey shapePairKey && this.first == shapePairKey.first && this.second == shapePairKey.second;
@@ -618,7 +631,7 @@ public class Block extends BlockBehaviour implements ItemLike {
 
         @Override
         public int hashCode() {
-            return System.identityHashCode(this.first) * 31 + System.identityHashCode(this.second);
+            return this.hash; // Gale - cache ShapePairKey hash
         }
     }
 }
