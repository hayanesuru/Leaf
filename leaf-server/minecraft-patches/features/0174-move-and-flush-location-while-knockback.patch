From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Taiyou06 <kaandindar21@gmail.com>
Date: Sun, 11 May 2025 19:45:58 +0200
Subject: [PATCH] move and flush location while knockback


diff --git a/net/minecraft/world/entity/player/Player.java b/net/minecraft/world/entity/player/Player.java
index 9e62fe46eb9883ade81c1c9ff0f8220ed34b5d85..fb61bf4b69033d856e2ed424a0557d1f6a27e4e7 100644
--- a/net/minecraft/world/entity/player/Player.java
+++ b/net/minecraft/world/entity/player/Player.java
@@ -1420,6 +1420,25 @@ public abstract class Player extends LivingEntity {
                                 ((ServerPlayer)target).connection.send(new ClientboundSetEntityMotionPacket(target));
                                 target.hurtMarked = false;
                                 target.setDeltaMovement(deltaMovement);
+
+                                    // Leaf start
+                                    if (org.dreeam.leaf.config.modules.gameplay.Knockback.flushKnockback) {
+                                        ServerPlayer targetPlayer = (ServerPlayer) target;
+                                        Vec3 before = targetPlayer.getDeltaMovement();
+                                        targetPlayer.aiStep();
+                                        targetPlayer.setDeltaMovement(before);
+                                        targetPlayer.connection.send(new net.minecraft.network.protocol.game.ClientboundSetEntityMotionPacket(this));
+                                        targetPlayer.connection.send(net.minecraft.network.protocol.game.ClientboundEntityPositionSyncPacket.of(this));
+                                        targetPlayer.connection.resumeFlushing();
+                                        targetPlayer.hasImpulse = true;
+                                        if (this instanceof ServerPlayer player1) {
+                                            player1.connection.send(new net.minecraft.network.protocol.game.ClientboundSetEntityMotionPacket(targetPlayer));
+                                            player1.connection.send(net.minecraft.network.protocol.game.ClientboundEntityPositionSyncPacket.of(targetPlayer));
+                                            player1.connection.resumeFlushing();
+                                            player1.hasImpulse = true;
+                                        }
+                                    }
+                                    // Leaf end
                                 }
                                 // CraftBukkit end
                             }
